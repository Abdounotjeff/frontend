{% extends "base.html" %}
{% load static %}

{% block title %}
RACER | {{race.title}}
{% endblock title %}

{% block scripts %}
<link rel="stylesheet" href="{% static "css/dist/races.css" %}">
{% endblock scripts %}



{% block content %}

<!-- Hero Section -->

{% if messages %}
    <div class="fixed top-5 right-1/2 space-y-2 z-50">
        {% for message in messages %}
            <div class="px-4 py-3 rounded-lg shadow-md text-white 
                {% if message.tags == 'error' %} bg-red-500 {% elif message.tags == 'success' %} bg-green-500 {% elif message.tags == 'warning' %} bg-yellow-500 {% elif message.tags == 'info' %} bg-blue-500 {% else %} bg-gray-500 {% endif %} ">
                {{ message }}
            </div>
        {% endfor %}
    </div>
{% endif %}
<section
  class="hero2 flex flex-col justify-end items-start bg-center bg-cover w-full py-44 px-8 md:px-32 space-y-6"
  
>
  <h1 class="text-4xl md:text-6xl text-white font-bold">
    BECOME <span class="text-blue-400">THE</span> CHAMPION
  </h1>
</section>

<!-- Wrapper -->
<div class="flex flex-col md:flex-row justify-between text-left p-6 md:p-10 w-full">

  <!-- Left Side -->
  <div class="w-full md:w-3/4 border-2 border-gray-300/60 rounded-xl p-6 md:p-12 mb-8 md:mb-0">

    <!-- Race Title & Join Button -->
    <div class="flex justify-between items-center border-b pb-6 mb-6">
      <h1 class="text-3xl md:text-5xl font-bold underline">{{ race.title }}</h1>
      
    {% load tz %}  {# permet d'utiliser le filtre now avec timezone #}

{% if race.date > now %}
<form method="POST" action="{% url 'join_race' race.id %}">
  {% csrf_token %}
  <button type="submit"
    class="border-2 border-gray-300 px-6 py-3 rounded-lg hover:bg-gray-500/60 transition">
    JOIN NOW!
  </button>
</form>
{% else %}
<p class="text-red-500 font-semibold mt-2">Cette course est déjà terminée.</p>
{% endif %}

    </div>

    <!-- Organizer Info -->
    <p class="mb-6">
      Organised by:
      <a href="{% url 'profile' race.organised_by.user.username %}"
         class="text-blue-500 hover:underline font-semibold">
        {{ race.organised_by.user.username }}
      </a>
    </p>

    <!-- Race Info Grid -->
    <div class="flex flex-wrap justify-around gap-6 mb-10">
      <div>
        <p class="font-semibold">Category:</p>
        <p class="text-gray-600">{{ race.type }}</p>
      </div>

      <div>
        <p class="font-semibold">Location:</p>
        <p class="text-gray-600">{{ race.wilaya }}</p>
      </div>

      <div>
        <p class="font-semibold">Price:</p>
        <p class="text-gray-600">DA {{ race.price }}</p>
      </div>

      <div>
        <p class="font-semibold">Date & Time:</p>
        <p class="text-gray-600">
          {{ race.date|date:"M d, Y" }} <span class="ml-1">{{ race.date|time:"H:i" }}</span>
        </p>
      </div>

      <div>
        <p class="font-semibold">Racers:</p>
        <p class="text-gray-600">
          {{ race.participant_count }}/{{ race.max_racers|default:50 }}
        </p>
      </div>
    </div>

    <!-- Race Details -->
    <div class="space-y-10">
      <!-- Description -->
      <div>
        <p class="font-semibold mb-2">Description:</p>
        <p class="text-gray-700 leading-relaxed">
          {{ race.description }}
        </p>
      </div>

      <!-- Rules -->
      <div>
        <p class="font-semibold mb-2">Rules:</p>
        <p class="text-gray-700 leading-relaxed">
          {{ race.rules }}
        </p>
      </div>

      <!-- Allowed Ages -->
      <div>
        <p class="font-semibold mb-2">Allowed Ages:</p>
        <div class="flex flex-wrap gap-2">
          {% for age in race.Allowed_Ages.all %}
            <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm">
              {{ age.name }}
            </span>
          {% empty %}
            <p class="text-gray-500 italic">No age restrictions listed.</p>
          {% endfor %}
        </div>
      </div>

      <!-- Map -->
      <div>
        <p class="font-semibold mb-4">Place:</p>
        <iframe
          src="{{ race.get_embed_map_url }}"
          width="100%" height="450" class="rounded-lg border-0"
          allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
        </iframe>
      </div>
    </div>
  </div>

  <!-- Ads / Sponsor Section -->
  <section class="w-full md:w-1/4 border p-10 flex flex-col justify-center items-center text-center rounded-xl">
    <h1 class="text-xl font-semibold">ADS</h1>
  </section>
</div>

{% endblock %}
