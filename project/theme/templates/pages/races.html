{% extends "base.html" %}
{% load static %}

{% block title %} | Races List {% endblock %}
{% block scripts %}
<link rel="stylesheet" href="{% static "css/dist/races.css" %}">
{% endblock scripts %}

{% block content %}
<!-- Hero -->
<main class="hero flex flex-col justify-end items-start bg-center bg-cover w-full py-44 px-10 md:px-32 space-y-6">
  <h1 class="text-5xl md:text-6xl text-white">JOIN <span class="text-blue-400 font-bold">THE</span> RACE</h1>
</main>

<!-- Search -->
<section class="flex pt-10 w-full justify-center items-center">
  <form method="GET" class="max-w-md mx-auto w-full">
    <div class="relative">
      <input type="search" name="q"
        value="{{ request.GET.q|default:'' }}"
        class="block w-full p-4 ps-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500"
        placeholder="Search Title, Category..." />
      <button type="submit"
        class="absolute start-0 bottom-2.5 px-4 py-2 text-gray-500 hover:text-blue-500 transition">
        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
        </svg>
      </button>
    </div>
  </form>
</section>

<!-- Main Content -->
<section class="w-full flex flex-col md:flex-row h-fit px-6 md:px-20 mt-8">

  <!-- Sidebar -->
  <aside class="flex flex-col w-full md:w-1/4 py-8 space-y-6">
    <h1 class="text-2xl md:text-3xl font-semibold">Categories</h1>
    <ul class="flex flex-col space-y-1 py-3">
      {% for category in categories %}
      <li class="w-full border-b flex justify-between cursor-pointer">
        <a href="?category={{ category.name }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}"
           class="text-lg font-medium hover:text-blue-500">
          {{ category.name }}
        </a>
        <span class="px-1 flex justify-center items-center rounded-full text-xs bg-gray-400 text-white">
          {{ category.count }}
        </span>
      </li>
      {% empty %}
      <p class="text-gray-500 italic">No categories available.</p>
      {% endfor %}
    </ul>
  </aside>

  <!-- Races list -->
  <section class="w-full md:w-3/4 h-fit p-4 md:p-10 space-y-6">
    <div class="flex flex-col md:flex-row md:items-center md:space-x-4">
      <h1 class="text-3xl font-semibold">Races</h1>
      <div class="flex items-center space-x-2 text-sm text-blue-500">
        <span>Filter:</span>
        {% for option in sort_options %}
  <a href="?sort={{ option }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}"
     class="hover:underline {% if request.GET.sort == option %}font-bold text-blue-700{% endif %}">
    {{ option|title }}
  </a>
{% endfor %}

      </div>
    </div>

    <!-- Race Cards -->
    <div class="flex flex-col space-y-7 max-h-[800px] overflow-y-scroll">
      {% for race in races %}
      <div class="flex flex-col md:flex-row rounded-lg overflow-hidden border shadow-sm hover:shadow-xl duration-200">
        <div class="w-full md:w-[40%] md:h-44">
          <img src="{{ race.logo.url|default:'/static/images/default-race.jpg' }}" alt="{{ race.title }}"
            class="w-full h-full object-cover">
        </div>
        <div class="flex flex-col justify-center items-start w-full md:w-[60%] p-4 space-y-2">
          <div class="flex justify-between w-full">
            <h1 class="text-xl font-mono font-semibold">{{ race.title }}</h1>
            <p class="text-gray-600">{{ race.date|date:"d/m/Y" }}</p>
          </div>
          <h2 class="text-gray-500">{{ race.type }}</h2>
          <p class="text-gray-600 line-clamp-2">{{ race.description|truncatewords:25 }}</p>
          <a href="{% url 'profile' race.organised_by.user.username %}" class="underline hover:text-blue-400" style="text-decoration:none">Organizer by: {{ race.organised_by.user.username }}</a>
          <a href="{% url 'race_detail' race.pk %}" class="underline hover:text-blue-400">View more</a>
        </div>
      </div>
      {% empty %}
      <p class="text-gray-500 italic">No races found.</p>
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
    <div class="flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 mt-4">
      <div class="text-sm text-gray-700">
        Showing <span class="font-medium">{{ page_obj.start_index }}</span>
        to <span class="font-medium">{{ page_obj.end_index }}</span>
        of <span class="font-medium">{{ page_obj.paginator.count }}</span> results
      </div>
      <div class="flex space-x-1">
        {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}"
             class="px-3 py-1 rounded-md text-gray-700 border hover:bg-gray-100">Previous</a>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
          {% if num == page_obj.number %}
            <span class="px-3 py-1 rounded-md bg-blue-600 text-white">{{ num }}</span>
          {% else %}
            <a href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}"
               class="px-3 py-1 rounded-md border hover:bg-gray-100">{{ num }}</a>
          {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}"
             class="px-3 py-1 rounded-md text-gray-700 border hover:bg-gray-100">Next</a>
        {% endif %}
      </div>
    </div>
    {% endif %}
  </section>
</section>
{% endblock %}
